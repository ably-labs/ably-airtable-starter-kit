(function(e){function t(t){for(var a,r,o=t[0],c=t[1],u=t[2],d=0,h=[];d<o.length;d++)r=o[d],Object.prototype.hasOwnProperty.call(s,r)&&s[r]&&h.push(s[r][0]),s[r]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);l&&l(t);while(h.length)h.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],a=!0,o=1;o<n.length;o++){var c=n[o];0!==s[c]&&(a=!1)}a&&(i.splice(t--,1),e=r(r.s=n[0]))}return e}var a={},s={app:0},i=[];function r(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=a,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var u=0;u<o.length;u++)t(o[u]);var l=c;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";n("85ec")},"0593":function(e,t,n){"use strict";n("4b74")},1:function(e,t){},2:function(e,t){},"4b74":function(e,t,n){},"4fbb":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t),n.d(t,"backgroundEventBus",(function(){return ie}));n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return this.isAblyConnected?n("div",{staticClass:"app-container",attrs:{id:"app"}},[n("ChatCard",{attrs:{chatChannelInstance:e.chatChannelInstance,myClientId:e.myClientId,chatMsgsArray:e.chatMsgsArray}}),n("InfoCard",{attrs:{chatMsgsArray:e.chatMsgsArray}})],1):e._e()},i=[],r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"chat-window-container"},[n("div",{staticClass:"card chat-card"},[e._m(0),n("div",{ref:"chatMsgsBox",staticClass:"card-body chat-box "},[e.isReadyToChat?e._e():n("UsernameInput",{attrs:{saveUsernameAndJoin:e.saveUsernameAndJoin}}),e.isReadyToChat?[e.showLoadMoreBtn?n("div",{staticClass:"load-more-div"},[n("button",{staticClass:"btn load-more-btn",attrs:{type:"button"},on:{click:function(t){return e.loadPreviousMsgs()}}},[e._v(" Load previous messages "),n("span",{staticClass:"badge badge-light"},[e._v("⬆︎")])])]):e._e(),e._l(e.chatMsgsArray,(function(t){return n("ChatMessage",{key:t.messageContent.msgId,attrs:{message:t,myClientId:e.myClientId}})}))]:e._e()],2),n("div",{staticClass:"card-footer input-footer"},[e.isReadyToChat?n("ChatInput",{attrs:{chatChannelInstance:e.chatChannelInstance,clientUsername:e.clientUsername,myClientId:e.myClientId}}):e._e()],1)])])},o=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card-header chat-header"},[n("div",{staticClass:"header-data"},[e._v(" Group Chat Demo - Ably | Airtable ")])])}],c=(n("4160"),n("159b"),n("96cf"),n("1da1")),u=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"chat-message-container",class:{"msg-left":!e.isMsgMine,"msg-right":e.isMsgMine}},[n("div",{staticClass:"card chat-message",class:{"msg-bg-right":e.isMsgMine,"msg-bg-left":!e.isMsgMine,"card-rounded-right-only":!e.isMsgMine,"card-rounded-left-only":e.isMsgMine}},[n("div",{staticClass:"card-body"},[n("p",{staticClass:"card-text message-text"},[e._v(" "+e._s(e.message.messageContent["chat-message"])+" ")]),n("p",{staticClass:"card-text",class:{"meta-text-left":!e.isMsgMine,"meta-text-right":e.isMsgMine}},[n("small",{},[e._v("at "+e._s(e.messageTime12HrFormat)+" "),e.isMsgFromToday?e._e():[e._v(" on "+e._s(this.date)+"/"+e._s(this.month)+" ")],e.isMsgFromToday?[e._v(" today ")]:e._e(),e._v(" by "+e._s(e.message.messageContent.username)+" ")],2)])])])])},l=[],d=(n("99af"),n("ac1f"),n("1276"),n("3835")),h={name:"ChatMessage",props:["message","myClientId"],data:function(){return{weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],messageTime12HrFormat:null,isMsgMine:null,msgType:null,timeHours:null,timeMinutes:null,timeAMPM:null,date:null,month:null,year:null,weekday:null,isMsgFromToday:!1}},methods:{computeLiveMsgTime:function(){var e=new Date(this.message.msgTimestamp);(this.isMsgFromToday=this.isToday(e))||(this.date=e.getDate(),this.month=e.getMonth()+1,this.year=e.getFullYear());var t=e.getHours(),n=e.getMinutes();this.convertTo12HrFormat(t,n)},convertTo12HrFormat:function(e,t){t=(t<10?"0":"")+t;var n=e<12?"am":"pm";e=e%12||12,this.formatTime(e,t,n)},formatTime:function(e,t,n){this.messageTime12HrFormat="".concat(e,":").concat(t," ").concat(n)},computeDbMsgTime:function(){var e=this.message.messageContent["created-time"],t=e.split(/[- \sT:.]/),n=Object(d["a"])(t,6),a=n[0],s=n[1],i=n[2],r=n[3],o=n[4],c=n[5],u=new Date("".concat(a,"/").concat(s,"/").concat(i," ").concat(r,":").concat(o,":").concat(c," UTC"));(this.isMsgFromToday=this.isToday(u))||(this.date=u.getDate(),this.month=u.getMonth()+1,this.year=u.getFullYear()),this.convertTo12HrFormat(u.getHours(),u.getMinutes())},isToday:function(e){var t=new Date;return t.getDate()==e.getDate()&&t.getMonth()==e.getMonth()&&t.getFullYear()==e.getFullYear()}},created:function(){this.isMsgMine=this.message.messageContent.clientId===this.myClientId,this.msgType=this.message.messageContent.msgType,"live"==this.message.msgType?this.computeLiveMsgTime():"db"==this.message.msgType&&this.computeDbMsgTime()}},m=h,p=(n("8684"),n("2877")),g=Object(p["a"])(m,u,l,!1,null,"47628e76",null),b=g.exports,f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"input-group input-div"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.myMessageContent,expression:"myMessageContent"}],staticClass:"form-control chat-input",attrs:{type:"text",placeholder:"Send a message...","aria-label":"Send a message...","aria-describedby":"button-addon2"},domProps:{value:e.myMessageContent},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.publishMessage()},input:function(t){t.target.composing||(e.myMessageContent=t.target.value)}}}),n("div",{staticClass:"input-group-append send-btn-div"},[n("button",{staticClass:"btn send-btn",attrs:{type:"button",id:"button-addon2"},on:{click:function(t){return e.publishMessage()}}},[n("i",{staticClass:"fas fa-paper-plane"})])])])},y=[],C=(n("d3b7"),n("25f0"),{name:"InfoCard",props:["chatChannelInstance","clientUsername","myClientId"],data:function(){return{myMessageContent:"",msgPayload:null,myUsername:null}},methods:{publishMessage:function(){if(""!=this.myMessageContent){var e="id-"+Math.random().toString(36).substr(2,16);this.msgPayload=[{fields:{clientId:this.myClientId,msgId:e,username:this.clientUsername,"chat-message":this.myMessageContent}}],this.chatChannelInstance.publish("chat-msg",{records:this.msgPayload}),ie.$emit("updateBackgroundEventStatus","publish-msg"),this.myMessageContent=""}}}}),v=C,M=(n("0593"),Object(p["a"])(v,f,y,!1,null,"cbd1f4ba",null)),I=M.exports,w=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card username-input-div"},[n("div",{staticClass:"card-body"},[n("div",{staticClass:"input-group "},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],staticClass:"form-control usn-input",attrs:{type:"text",placeholder:"Username","aria-label":"Username","aria-describedby":"button-addon2"},domProps:{value:e.username},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.saveUsernameAndJoin(e.username)},input:function(t){t.target.composing||(e.username=t.target.value)}}}),n("div",{staticClass:"input-group-append"},[n("button",{staticClass:"btn btn-outline-secondary usn-save-btn",attrs:{type:"button",id:"button-addon2"},on:{click:function(t){return e.saveUsernameAndJoin(e.username)}}},[e._v(" Join chat ")])])])])])},S=[],k={name:"Username",props:["saveUsernameAndJoin"],data:function(){return{username:""}}},T=k,_=(n("85da"),Object(p["a"])(T,w,S,!1,null,null,null)),x=_.exports,A=n("49e1"),L=n("a1bc"),B={name:"ChatCard",props:["chatChannelInstance","myClientId","updateBackgroundStatus","chatMsgsArray"],components:{ChatMessage:b,ChatInput:I,UsernameInput:x},data:function(){return{airData:null,isReadyToChat:!1,clientUsername:"",isMsgMine:!0,dbAutoNumber:null,base:null,latestMsgId:null,showLoadMoreBtn:!0}},methods:{saveUsernameAndJoin:function(e){this.clientUsername=e,this.isReadyToChat=!0,this.chatChannelInstance.presence.enter(e),ie.$emit("updateBackgroundEventStatus","join-chat")},handleNewMessage:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function n(){var a,s,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=e.data.records[0].fields,s=e.timestamp,n.next=4,t.chatMsgsArray.push({messageContent:a,msgTimestamp:s,msgType:"live"});case 4:t.$refs.chatMsgsBox&&(i=t.$refs.chatMsgsBox.scrollHeight,t.$refs.chatMsgsBox.scrollTop=i),a.clientId!=t.myClientId&&t.isReadyToChat&&ie.$emit("updateBackgroundEventStatus","live-msgs-loaded");case 6:case"end":return n.stop()}}),n)})))()},loadPreviousMsgs:function(){this.chatMsgsArray[0]?this.getMsgsFromDBWithMsgID():this.getLatestMsgsFromDB()},getMsgsFromDBWithMsgID:function(){var e=this;this.latestMsgId=this.chatMsgsArray[0].messageContent.msgId,this.showLoadMoreBtn=!1,setTimeout((function(){e.showLoadMoreBtn=!0}),500),this.base=new A({apiKey:L["AIRTABLE_API_KEY"]}).base(L["AIRTABLE_BASE_ID"]);var t=this;this.base("Table 1").select({view:"Grid view",filterByFormula:"SEARCH('"+t.latestMsgId+"',{msgId})"}).eachPage((function(e,n){var a=e[0].fields.ID;t.dbAutoNumber=a,a?t.getMsgsFromDBWithAutoID():n()}))},getMsgsFromDBWithAutoID:function(){var e=this;this.base("Table 1").select({maxRecords:3,view:"Grid view",filterByFormula:"({ID}<"+e.dbAutoNumber+")",sort:[{field:"ID",direction:"desc"}]}).eachPage((function(t,n){t.forEach(function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.chatMsgsArray.unshift({messageContent:n.fields,msgTimestamp:123,msgType:"db"});case 2:ie.$emit("updateBackgroundEventStatus","db-msgs-loaded"),e.$refs.chatMsgsBox&&(e.$refs.chatMsgsBox.scrollTop=0);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),n()}),(function(e){e&&console.error(e)}))},getLatestMsgsFromDB:function(){this.base=new A({apiKey:L["AIRTABLE_API_KEY"]}).base(L["AIRTABLE_BASE_ID"]);var e=this;this.base("Table 1").select({maxRecords:3,view:"Grid view",sort:[{field:"ID",direction:"desc"}]}).eachPage((function(t,n){t.forEach(function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.chatMsgsArray.unshift({messageContent:n.fields,msgTimestamp:123,msgType:"db"});case 2:ie.$emit("updateBackgroundEventStatus","db-msgs-loaded"),e.$refs.chatMsgsBox&&(e.$refs.chatMsgsBox.scrollTop=0);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),n()}),(function(e){e&&console.error(e)}))}},created:function(){var e=this;this.isReadyToChat=!1,this.chatChannelInstance.subscribe((function(t){e.handleNewMessage(t)}))}},E=B,P=(n("c621"),Object(p["a"])(E,r,o,!1,null,null,null)),R=P.exports,D=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"background-info-container"},[n("div",{staticClass:"card background-info-card"},[n("div",{staticClass:"background-info-header text-white card-header"},[e._v(" Play-by-play of behind the scenes ")]),n("div",{staticClass:"background-info-body card-body text-dark"},[n("CurrentStatusText",{attrs:{backgroundInfoText:e.backgroundInfoText,infoLinkText:e.infoLinkText,infoLinkHref:e.infoLinkHref,showSecondLink:e.showSecondLink}}),e.showCodeSnippet?n("CodeSnippet",{attrs:{whichCodeSnippet:e.whichCodeSnippet}}):e._e()],1)])])},O=[],j=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"code-sample-container"},[n("span",[n("VueCodeHighlight",{staticClass:"code-sample",attrs:{language:"javascript"}},[e._v(" "+e._s(e.jscode)+" ")])],1)])},H=[],F=n("d36c"),U=(n("4357"),{name:"CodeSnippet",components:{VueCodeHighlight:F["a"]},props:["whichCodeSnippet"],data:function(){return{jscode:null,ablyConnectionCodeSnippet:null,ablyPresenceCodeSnippet:null,ablyPubSubCodeSnippet:null,ablySubOnlyCodeSnippet:null,airTableCodeSnippet:null}},methods:{updateCodeSnippet:function(){switch(this.whichCodeSnippet){case"ably-connected":this.jscode=this.ablyConnectionCodeSnippet;break;case"ably-presence":this.jscode=this.ablyPresenceCodeSnippet;break;case"ably-pubsub":this.jscode=this.ablyPubSubCodeSnippet;break;case"ably-sub-only":this.jscode=this.ablySubOnlyCodeSnippet;break;case"airtable-db":this.jscode=this.airTableCodeSnippet;break}}},created:function(){this.ablyConnectionCodeSnippet="\n    ablyRealtimeInstance = new Ably.Realtime({\n      key: 'ablyAPIKey',\n      clientId: 'uniqueId',\n    });\n    ablyRealtimeInstance.connection.on(\"connected\", () => {\n      chatChannelInstance = ablyRealtimeInstance.channels.get(\n        '[?rewind=2m]chat-airtable'\n      );\n    });\n    ",this.ablyPresenceCodeSnippet="\n    chatChannelInstance.subscribe((msg) => {\n      handleNewMessage(msg);\n    });\n    chatChannelInstance.presence.enter(username);\n    ",this.ablyPubSubCodeSnippet='\n    chatChannelInstance.subscribe("chat-msg", (msg) => {\n      handleNewMessage(msg);\n    });\n\n    chatChannelInstance.publish("chat-msg", {\n      records: msgPayload,\n    });\n    ',this.ablySubOnlyCodeSnippet='\n    chatChannelInstance.subscribe("chat-msg", (msg) => {\n      handleNewMessage(msg);\n    });\n    ',this.airTableCodeSnippet='\n      airtableDBbase = new Airtable({ apiKey: \'apiKey\' }).base(\'baseId\');\n      airtableDBbase("Table 1").select({\n          maxRecords: 3,\n          view: "Grid view",\n          sort: [{ field: "ID", direction: "desc" }],\n      })\n      .eachPage(\n        function page(records, fetchNextPage) {\n          records.forEach(async function(record) {\n            await chatMsgsArray.unshift({\n              messageContent: record.fields,\n              msgTimestamp: 123,\n              msgType: "db",\n            });\n          });\n          fetchNextPage();\n        }\n      );\n    ',this.whichCodeSnippet="ably-connected",this.updateCodeSnippet()},watch:{whichCodeSnippet:function(){this.updateCodeSnippet()}}}),$=U,N=(n("67cc"),Object(p["a"])($,j,H,!1,null,null,null)),J=N.exports,G=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card command-info"},[n("div",{staticClass:"card-body current-status"},[n("p",[n("strong",[e._v("Current Status: ")]),e._v(e._s(e.backgroundInfoText))]),n("a",{attrs:{href:e.infoLinkHref,target:"_blank"}},[e._v(" "+e._s(e.infoLinkText)+" ")]),e.showSecondLink?[e._v("or "),n("a",{attrs:{href:"https://airtable.com/shrBExmY1lK3yyupo/tble6R4YjCEuP8A7x",target:"_blank"}},[e._v(" see the database schema for this app ")])]:e._e()],2)])},Y=[],K={name:"CurrentStatusText",props:["backgroundInfoText","infoLinkText","infoLinkHref","showSecondLink"],data:function(){return{}},created:function(){}},W=K,V=(n("5713"),Object(p["a"])(W,G,Y,!1,null,null,null)),q=V.exports,Q={name:"InfoCard",components:{CodeSnippet:J,CurrentStatusText:q},props:["chatMsgsArray"],data:function(){return{showCodeSnippet:!1,backgroundInfoText:"",infoLinkText:"",infoLinkHref:"",showSecondLink:!1,backgroundStatusList:{JOIN_CHAT:"join-chat",PUBLISH_MSG:"publish-msg",LIVE_MSGS_LOADED:"live-msgs-loaded",DB_MSGS_LOADED:"db-msgs-loaded"},currentBackgroundStatus:null,whichCodeSnippet:null}},created:function(){var e=this;this.backgroundInfoText="Successfully connected to Ably Realtime, attached to the 'chat-airtable' channel with the rewind parameter set to 2min.",this.infoLinkText="Learn more about the 'Ably Rewind' channel param",this.infoLinkHref="https://www.ably.io/documentation/realtime/channels/channel-parameters/rewind",this.whichCodeSnippet="ably-connected",this.showCodeSnippet=!0,ie.$on("updateBackgroundEventStatus",(function(t){switch(t){case e.backgroundStatusList.JOIN_CHAT:e.backgroundInfoText="Added a subscription listener on the chat channel and joined the chat by entering the presence set.",e.chatMsgsArray.length>0&&(e.backgroundInfoText+=" Received "+e.chatMsgsArray.length+" rewound message(s)."),e.whichCodeSnippet="ably-presence",e.infoLinkText="Learn more about the 'Ably Presence' feature",e.infoLinkHref="https://www.ably.io/documentation/realtime/presence",e.showSecondLink=!1;break;case e.backgroundStatusList.PUBLISH_MSG:e.backgroundInfoText="Published a message and received it as a live subscription update.",e.whichCodeSnippet="ably-pubsub",e.infoLinkText="Learn more about the 'Ably Pub/Sub' feature",e.infoLinkHref="https://www.ably.io/pub-sub-messaging",e.showSecondLink=!1;break;case e.backgroundStatusList.LIVE_MSGS_LOADED:e.backgroundInfoText="Received a new message as a live subscription update.",e.whichCodeSnippet="ably-sub-only",e.infoLinkText="Learn more about the 'Ably Pub/Sub' feature",e.infoLinkHref="https://www.ably.io/pub-sub-messaging",e.showSecondLink=!1;break;case e.backgroundStatusList.DB_MSGS_LOADED:e.backgroundInfoText="Received 3 old messages from the Airtable database.",e.whichCodeSnippet="airtable-db",e.infoLinkText="Check out the Airtable REST API",e.infoLinkHref="https://airtable.com/api",e.showSecondLink=!0;break}}))}},X=Q,z=(n("906f"),Object(p["a"])(X,D,O,!1,null,null,null)),Z=z.exports,ee=n("6be2"),te={name:"App",components:{ChatCard:R,InfoCard:Z},data:function(){return{chatMsgsArray:[],ablyRealtimeInstance:null,isAblyConnected:!1,chatChannelId:"[?rewind=2m]chat-airtable",chatChannelInstance:null,myClientId:""}},methods:{},created:function(){var e=this;this.ablyRealtimeInstance=new ee["Realtime"]({authUrl:"/auth"}),this.ablyRealtimeInstance.connection.once("connected",(function(){e.myClientId=e.ablyRealtimeInstance.auth.clientId,e.isAblyConnected=!0,e.chatChannelInstance=e.ablyRealtimeInstance.channels.get(e.chatChannelId)}))},destroyed:function(){this.ablyRealtimeInstance.connection.close()}},ne=te,ae=(n("034f"),Object(p["a"])(ne,s,i,!1,null,null,null)),se=ae.exports;a["a"].config.productionTip=!1;var ie=new a["a"];new a["a"]({render:function(e){return e(se)}}).$mount("#app")},5713:function(e,t,n){"use strict";n("ddca")},"67cc":function(e,t,n){"use strict";n("4fbb")},"71ed":function(e,t,n){},"7c37":function(e,t,n){},"85da":function(e,t,n){"use strict";n("e3cb")},"85ec":function(e,t,n){},8684:function(e,t,n){"use strict";n("7c37")},"906f":function(e,t,n){"use strict";n("d097")},a1bc:function(e,t){e.exports={ABLY_API_KEY:"3HJUPg.OgPRiQ:g2tcLqp0prQaBMar",AIRTABLE_API_KEY:"keytHvqXSpaHaWt0M",AIRTABLE_BASE_ID:"app8m8AJQsvMuxfIX"}},c621:function(e,t,n){"use strict";n("71ed")},d097:function(e,t,n){},ddca:function(e,t,n){},e3cb:function(e,t,n){}});
//# sourceMappingURL=app.e66457ef.js.map